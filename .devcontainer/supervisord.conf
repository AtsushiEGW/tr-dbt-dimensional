[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700

[supervisord]
nodaemon=true
pidfile=/tmp/supervisord.pid
loglevel=info

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

; ==================== X/WM/VNC/NoVNC ====================

[program:xvfb]
command=/usr/bin/Xvfb :99 -screen 0 1920x1080x24
priority=10
autostart=true
autorestart=true
startsecs=2
stopasgroup=true
killasgroup=true
environment=DISPLAY=":99"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:fluxbox]
command=fluxbox
priority=20
autostart=true
autorestart=true
startsecs=2
stopasgroup=true
killasgroup=true
environment=DISPLAY=":99"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:x11vnc]
; Docker ビルド時に /home/dev/.vnc/passwd を作成済みの前提
command=x11vnc -forever -create -display :99 -shared -rfbport 5900 -rfbauth /home/dev/.vnc/passwd
priority=30
autostart=true
autorestart=true
startsecs=2
stopasgroup=true
killasgroup=true
environment=DISPLAY=":99"
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:novnc]
; ★ noVNC 標準ランチャで起動（websockify は symlink 済み）
command=/bin/sh -lc 'exec /usr/local/bin/python -u /opt/novnc/utils/novnc_proxy --vnc localhost:5900 --listen 0.0.0.0:6080 --web /opt/novnc --verbose'
priority=40
autostart=true
autorestart=true
startsecs=3
startretries=10
stopasgroup=true
killasgroup=true
environment=PYTHONUNBUFFERED="1"
; ログをファイルに出す（supervisorctl で読める）
stdout_logfile=/var/log/novnc.stdout.log
stdout_logfile_maxbytes=0
stderr_logfile=/var/log/novnc.stderr.log
stderr_logfile_maxbytes=0